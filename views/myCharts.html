<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Glitch!</title>
    <meta name="description" content="A cool thing made with Glitch">
    <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/style.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

   </head>
  <body>
    
<div class = "container" id = "userBox">

  <span class ="white" id = "name">
  </span>

    <span class ="white" id = "infor">
  </span>
  <center>
  <h1 class="white" id = "as">
Notitia  
  </h1>
  <h3 class="white">
    Make and Take Surveys
  </h3>
        <center>

          <a href = "/dashboard">
          <button class = "logoutBut">
            Back
          </button>
        </a>
          <div id = "buttons">
          </div>
          <div id = "link">
          </div>

          <div class = "rows">
            <div class ="col-md-2">
            </div>
            <div class = col-md-6>
                <div id = "graph">
    </div>
  </div>
  <div class = col-md-4>
    <form id ="formOptions" method = "POST" action="/submitResponse">

    </form>
  </div>
  </div>
    </center>
  </center>


<div id = "userData">
</div>

</div>


    <script src="https://d3js.org/d3.v4.js"></script>
    <script>
        //Parses name
     var variable = document.cookie.split(";")
    var parsed = variable[0].split("=")
     var userID = parsed[1];
    
    //parse
    var variable = document.cookie.split(";")
    var stepBarObjects = variable[1].split("=")
    var barObjects = JSON.parse(stepBarObjects[0])


    //End Cookie Parse
          //Buttons created in forEach fx below will dictate what index of dataset is to be used.

      var nameArray = []
      var copyNameArray =[];
    barObjects.forEach(function(x,i){

      nameArray.push(Object.keys(x));
      copyNameArray.push(Object.keys(x));
      $("#buttons").append("<button onClick = 'setIndex("+i+")' class='logoutBut'>"+x.title+"</button>   ")
    })
    
 

        for(var i = 0; i<nameArray.length; i++){
          for(var j=0; j<nameArray[i].length;j++){
            if(nameArray[i][j] === "title"){
              nameArray[i].splice(j,1)
              copyNameArray[i].splice(j,1)
            }
          }
        }
       
        for(var i = 0; i<nameArray.length; i++){
          for(var j=0; j<nameArray[i].length;j++){
            var pos = nameArray[i][j]
          nameArray[i][j] = barObjects[i][pos]
          }
        }
        dataset = nameArray
   

     var q = 0;
    function setIndex(i){
       var titleValue = barObjects[q]["title"]
      var urlTitle = titleValue.replace(/ /g, "_")
      $("#link").html("https://jealous-ellipse.glitch.me/takesurvey/"+userID+"+"+urlTitle)
      q = i;
      d3.select("svg").remove();
      $("#formOptions").html('');
     
       document.getElementById("infor").innerHTML = titleValue;
             copyNameArray[q].forEach((x,i)=>{
        $("#formOptions").append(x+"<br><input class='radios' name = 'bawton' type = 'radio' value ="+'"'+x+'"'+"></input>")
        if(i === copyNameArray[q].length-1){
          $("#formOptions").append("<input type = 'hidden' value = "+'"'+titleValue+'"'+" name='title'></input><input type = 'hidden' name = 'nonuser' value = "+false+"></input>")
        $("#formOptions").append("<br><input type = 'submit'></input>")
      }
      })
      graph();
    }
           
    
    
  function graph(){
var h = 400;
var w = 700
var padding = 60;
        
        const xScale = d3.scaleLinear()
          .domain([0,5])
     .range([padding, w + padding]);
    
    const yScale = d3.scaleLinear()
                .domain([d3.min(dataset[q]), d3.max(dataset[q])])
     .range([h - padding, padding]);
        
var canvas =d3.select("#graph")
        .append("svg")
        .attr("width", h)
        .attr("height",w)

 var bars = canvas.selectAll("rect")
  .data(dataset[q])
    .enter()
     .append("rect")
      .attr("height",(d)=>{

      return yScale(d)
    })
      .attr("width",(d,i)=>{
      return 50;
    })
      .attr("y", function(d,i){
    return h-yScale(d)-padding;
  })
       .attr("x", function(d,i){
    return i*85+padding;
  })
      .attr("fill", "blue")
      .append("title")
      .text((d,i)=>{
        return copyNameArray[q][i]+": " + d
      });

     const xAxis = d3.axisBottom(xScale)
    canvas.append("g")
       .attr("transform", "translate(0," + (h-padding) + ")")  
       .call(xAxis);
    const yAxis = d3.axisLeft(yScale);
    canvas.append("g")
    .attr("transform", "translate("+(padding)+",0)")
          .call(yAxis);
        }

    </script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>

   
</body>
</html>
