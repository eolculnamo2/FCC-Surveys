<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Glitch!</title>
    <meta name="description" content="A cool thing made with Glitch">
    <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/style.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

   </head>
  <body>
    
<div class = "container" id = "userBox">
    <span class ="white" id = "infor">
  </span>
  <center>
  <h1 class="white" id = "as">
Notitia  
  </h1>
  <h3 class="white">
    Make and Take Surveys
  </h3>
        <center>
          <div id = "buttons">
          </div>
    <div id = "graph">
    </div>
    </center>
  </center>

<div id = "userData">
</div>
</div>


    <script src="https://d3js.org/d3.v4.js"></script>
    <script>
                 
    //parse
    var variable = document.cookie.split(";")
    var stepBarObjects = variable[1].split("=")
    var barObjects = JSON.parse(stepBarObjects[0])

    //End Cookie Parse
          //Buttons created in forEach fx below will dictate what index of dataset is to be used.
      var q = 0;
    function setIndex(i){
      q = i;
      d3.select("svg").remove();
      graph();
    }
           
      var nameArray = []
    barObjects.forEach(function(x,i){

      nameArray.push(Object.keys(x));

      $("#buttons").append("<button onClick = 'setIndex("+i+")' class='logoutBut'>"+x.title+"</button>   ")
    })
    

        for(var i = 0; i<nameArray.length; i++){
          for(var j=0; j<nameArray[i].length;j++){
            if(nameArray[i][j] === "title"){
              nameArray[i].splice(j,1)
            }
          }
        }
    
        for(var i = 0; i<nameArray.length; i++){
          for(var j=0; j<nameArray[i].length;j++){
            var pos = nameArray[i][j]
          nameArray[i][j] = barObjects[i][pos]
          }
        }
        dataset = nameArray
   

    document.getElementById("infor").innerHTML = dataset;


      
   
                  
    
  function graph(){
    var margin = {"top": 20, "right": 20, "bottom": 50, "left": 70}

var h = 400 - margin.left - margin.right;
var w = 700 - margin.top - margin.bottom;
var padding = 60;
        
    const xScale = d3.scaleLinear()
     .domain([0,dataset[q].length])
     .range([padding, w + padding]);
    
    const yScale = d3.scaleLinear()
      .domain([
        d3.min(dataset[q]),
         d3.max(dataset[q])
         ])
     .range([h - padding, padding]);
        
var canvas =d3.select("#graph")
        .append("svg")
        .attr("width", h)
        .attr("height",w)
 var bars = canvas.selectAll("rect")
  .data(dataset[q])
    .enter()
     .append("rect")
      .attr("height",(d)=>{
      return yScale(d)
    })
      .attr("width",(d,i)=>{
      return xScale(i);
    })
      .attr("y", function(d,i){
    return h-yScale(d);
  })
       .attr("x", function(d,i){
    return i*85+padding;
  })
      .attr("fill", "blue")
 
 var tett = canvas.selectAll("div")
    .data(dataset[q])
    .enter()
     .append("div")
           .text((d)=>{return d})
 
     const xAxis = d3.axisBottom(xScale)
    canvas.append("g")
       .attr("transform", "translate(0," + (h) + ")")  
       .call(xAxis);
    const yAxis = d3.axisLeft(yScale);
    canvas.append("g")
    .attr("transform", "translate("+(padding)+",0)")
          .call(yAxis);
  }
    
    </script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>

   
</body>
</html>
